<div id="phoneWrapper" style="overflow-y: scroll; display: none; height: 400px;">
    <h1 style="font-size: 21pt;">Student Phone Numbers</h1>
    <table>
        <thead>
            <tr>
                <th style="width: 185px;">Name Last, First</th>
                <th>Phone Number</th>
            </tr>
        </thead>
        <tbody id="studentInfo">
        </tbody>
    </table>
</div>

<script>
    function getFile(path) {
        var url = path + "courseStudentPhones.json",
            settings = {
                "X-Csrf-Token": localStorage['XSRF.Token']
            };

        $.ajax(url, settings)
            .done(function(result) {
                generateTable(result);
            })
            .fail(function(result) {
                //hide the widget
                $('#phoneWrapper').closest('.d2l-widget').css({
                    display: "none"
                });
            });
    }

    function getPath() {
        var settings = {
            "X-Csrf-Token": localStorage['XSRF.Token']
        };
        $.ajax("/d2l/api/lp/1.15/courses/{OrgUnitId}", settings)
            .done(function(result) {
                //FOR TESTING ONLY!
                /*var path = result.Path + "studentPhones/";*/

                var path = result.Path;

                getFile(path);
            }).fail(function() {
                //hide the widget completely
                $('#phoneWrapper').closest('.d2l-widget').css({
                    display: "none"
                });
            });
    }

    function generateTable(course) {
        //show the table
        $('#phoneWrapper').css({
            display: "block"
        });

        var row;
        course.students.forEach(function(student) {
            row = "<tr><td>" + student.name + "</td><td>" + student.phone + "</td></tr>";
            $(row).appendTo('tbody#studentInfo');
        });
    }

    document.addEventListener('DOMContentLoaded', getPath);

</script>
